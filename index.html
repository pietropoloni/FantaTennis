<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FantaTennis App</title>
  <meta name="description" content="Pick your fantasy tennis squad from the ATP Top 100." />
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/apple-touch-icon1-180.png" />
  <style>
    :root{
      --bg:#0b1020; --card:#111834; --text:#e5e7eb; --muted:#9aa4b2;
      --a:#ef4444; --b:#3b82f6; --c:#10b981; --d:#f59e0b;
      --ok:#22c55e; --ring:#334155;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0a0f1f 0%, #0f1731 100%);color:var(--text)}
    header{position:sticky;top:0;background:rgba(11,16,32,0.8);backdrop-filter:blur(10px);border-bottom:1px solid #1f2a44;z-index:5}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:4px 0 6px;font-size:1.5rem;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:.9rem}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;align-items:center}
    button{
      background:#1b2344;color:#e5e7eb;border:1px solid #2a3665;border-radius:12px;
      padding:10px 14px;font-weight:600;cursor:pointer;transition:.2s;box-shadow:0 1px 0 #000 inset
    }
    button:hover{transform:translateY(-1px);background:#1f2a55}
    button:disabled{opacity:.55;cursor:not-allowed}
    select{padding:6px 10px;border-radius:8px;background:#1b2344;color:#e5e7eb;border:1px solid #2a3665}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--ring);border-radius:999px;background:#0c132b}
    .dot{width:10px;height:10px;border-radius:999px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin:16px 0 28px}
    .card{
      background:var(--card);border:1px solid #1d2748;border-radius:16px;padding:12px 12px;
      display:flex;align-items:center;gap:12px;min-height:64px;transition:border-color .2s, transform .05s
    }
    .card:hover{border-color:#2a3a6a}
    .rank{
      width:44px;height:44px;border-radius:12px;display:grid;place-items:center;
      background:#0c132b;border:1px solid #26325a;color:#cbd5e1;font-weight:700
    }
    .name{font-weight:700;letter-spacing:.2px}
    .meta{color:var(--muted);font-size:.85rem;margin-top:2px}
    .tag{
      margin-left:auto;font-weight:800;display:inline-flex;align-items:center;justify-content:center;
      width:28px;height:28px;border-radius:8px;color:#0b1020
    }
    .tag.A{background:var(--a)}
    .tag.B{background:var(--b)}
    .tag.C{background:var(--c)}
    .tag.D{background:var(--d)}
    .card.sel{outline:2px solid #7dd3fc; outline-offset:2px; transform:translateY(-1px)}
    .toast{
      position:fixed;right:14px;bottom:14px;background:#111834;border:1px solid #2a3665;
      padding:12px 14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.25);z-index:10;max-width:90vw
    }
    .hide{display:none}
    .footer{color:var(--muted);font-size:.85rem;margin:20px 0 40px}
    .legend{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:6px}
    .bandCount{font-weight:700}
    a.link{color:#93c5fd;text-decoration:none;border-bottom:1px dotted #93c5fd}
    a.link:hover{border-bottom-style:solid}
    code{background:#0c132b;padding:2px 6px;border:1px solid #26325a;border-radius:6px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>FantaTennis</h1>
      <div class="sub">Pick up to <b>3 players per band</b> from the official ATP Top 100 (static list as of Aug 25, 2025).
        <span class="legend">
          <span class="pill"><span class="dot" style="background:var(--a)"></span> A (1–10) <span id="cntA" class="bandCount">0/3</span></span>
          <span class="pill"><span class="dot" style="background:var(--b)"></span> B (11–30) <span id="cntB" class="bandCount">0/3</span></span>
          <span class="pill"><span class="dot" style="background:var(--c)"></span> C (31–50) <span id="cntC" class="bandCount">0/3</span></span>
          <span class="pill"><span class="dot" style="background:var(--d)"></span> D (51–100) <span id="cntD" class="bandCount">0/3</span></span>
        </span>
      </div>
      <div class="controls">
        <button id="refreshBtn" disabled>↻ Static rankings</button>
        <button id="clearBtn">✕ Clear selections</button>
        <button id="copyBtn">⧉ Copy picks</button>
        <div style="margin-left:auto;font-weight:700">
          Budget left: <span id="budget">900M</span>
        </div>
      </div>
      <div class="controls" style="margin-top:8px">
        <label>
          Filter band:
          <select id="bandFilter">
            <option value="all">All</option>
            <option value="A">Band A (1–10)</option>
            <option value="B">Band B (11–30)</option>
            <option value="C">Band C (31–50)</option>
            <option value="D">Band D (51–100)</option>
          </select>
        </label>
      </div>
    </div>
  </header>

  <main class="wrap">
    <h2 style="margin-top:16px">My Picks</h2>
    <div id="selected" class="grid" aria-live="polite"></div>

    <div id="status" class="sub" role="status" aria-live="polite"></div>
    <div id="grid" class="grid" aria-live="polite" aria-busy="true"></div>

    <div class="footer">
      <p>Source: ATP Tour — Singles Rankings (numerical PDF). Snapshot date: <b>Aug 25, 2025</b>.</p>
      <p class="sub">Bands are non-overlapping: A (1–10), B (11–30), C (31–50), D (51–100). Selections are stored locally and work offline.</p>
    </div>
  </main>

  <div id="toast" class="toast hide" role="alert"></div>

  <script>
    // --- PWA registration ---
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }

    // ---- Static Top 100 (ATP Singles — as of Aug 25, 2025) ----
    const PLAYERS = [
      {rank:1, name:"Jannik Sinner"},
      {rank:2, name:"Carlos Alcaraz"},
      {rank:3, name:"Alexander Zverev"},
      {rank:4, name:"Taylor Fritz"},
      {rank:5, name:"Jack Draper"},
      {rank:6, name:"Ben Shelton"},
      {rank:7, name:"Novak Djokovic"},
      {rank:8, name:"Alex de Minaur"},
      {rank:9, name:"Karen Khachanov"},
      {rank:10, name:"Lorenzo Musetti"},
      {rank:11, name:"Holger Rune"},
      {rank:12, name:"Casper Ruud"},
      {rank:13, name:"Daniil Medvedev"},
      {rank:14, name:"Tommy Paul"},
      {rank:15, name:"Andrey Rublev"},
      {rank:16, name:"Jakub Mensik"},
      {rank:17, name:"Frances Tiafoe"},
      {rank:18, name:"Alejandro Davidovich Fokina"},
      {rank:19, name:"Francisco Cerundolo"},
      {rank:20, name:"Arthur Fils"},
      {rank:21, name:"Jiri Lehecka"},
      {rank:22, name:"Tomas Machac"},
      {rank:23, name:"Ugo Humbert"},
      {rank:24, name:"Alexander Bublik"},
      {rank:25, name:"Grigor Dimitrov"},
      {rank:26, name:"Flavio Cobolli"},
      {rank:27, name:"Felix Auger-Aliassime"},
      {rank:28, name:"Stefanos Tsitsipas"},
      {rank:29, name:"Denis Shapovalov"},
      {rank:30, name:"Tallon Griekspoor"},
      {rank:31, name:"Brandon Nakashima"},
      {rank:32, name:"Alex Michelsen"},
      {rank:33, name:"Gabriel Diallo"},
      {rank:34, name:"Luciano Darderi"},
      {rank:35, name:"Cameron Norrie"},
      {rank:36, name:"Alexei Popyrin"},
      {rank:37, name:"Giovanni Mpetshi Perricard"},
      {rank:38, name:"Alexandre Muller"},
      {rank:39, name:"Sebastian Baez"},
      {rank:40, name:"Corentin Moutet"},
      {rank:41, name:"Nuno Borges"},
      {rank:42, name:"Miomir Kecmanovic"},
      {rank:43, name:"Camilo Ugo Carabelli"},
      {rank:44, name:"Jaume Munar"},
      {rank:45, name:"Joao Fonseca"},
      {rank:46, name:"Lorenzo Sonego"},
      {rank:47, name:"Roberto Bautista Agut"},
      {rank:48, name:"Zizou Bergs"},
      {rank:49, name:"Gael Monfils"},
      {rank:50, name:"Learner Tien"},
      {rank:51, name:"Benjamin Bonzi"},
      {rank:52, name:"Matteo Berrettini"},
      {rank:53, name:"Fabian Marozsan"},
      {rank:54, name:"Francisco Comesana"},
      {rank:55, name:"Marcos Giron"},
      {rank:56, name:"Daniel Altmaier"},
      {rank:57, name:"Hamad Medjedovic"},
      {rank:58, name:"Jordan Thompson"},
      {rank:59, name:"Tomas Martin Etcheverry"},
      {rank:60, name:"Jacob Fearnley"},
      {rank:61, name:"Damir Dzumhur"},
      {rank:62, name:"Marin Cilic"},
      {rank:63, name:"Marton Fucsovics"},
      {rank:64, name:"Matteo Arnaldi"},
      {rank:65, name:"Mattia Bellucci"},
      {rank:66, name:"Pedro Martinez"},
      {rank:67, name:"Reilly Opelka"},
      {rank:68, name:"Hubert Hurkacz"},
      {rank:69, name:"Terence Atmane"},
      {rank:70, name:"Quentin Halys"},
      {rank:71, name:"Aleksandar Kovacevic"},
      {rank:72, name:"Laslo Djere"},
      {rank:73, name:"Botic van de Zandschulp"},
      {rank:74, name:"Yunchaokete Bu"},
      {rank:75, name:"Sebastian Korda"},
      {rank:76, name:"Kamil Majchrzak"},
      {rank:77, name:"Adrian Mannarino"},
      {rank:78, name:"Mariano Navone"},
      {rank:79, name:"Arthur Cazaux"},
      {rank:80, name:"David Goffin"},
      {rank:81, name:"Christopher O'Connell"},
      {rank:82, name:"Arthur Rinderknech"},
      {rank:83, name:"Jesper de Jong"},
      {rank:84, name:"Ethan Quinn"},
      {rank:85, name:"Adam Walton"},
      {rank:86, name:"Luca Nardi"},
      {rank:87, name:"Roberto Carballes Baena"},
      {rank:88, name:"Juan Manuel Cerundolo"},
      {rank:89, name:"Vit Kopriva"},
      {rank:90, name:"Kei Nishikori"},
      {rank:91, name:"Alexander Shevchenko"},
      {rank:92, name:"Jenson Brooksby"},
      {rank:93, name:"Filip Misolic"},
      {rank:94, name:"Roman Safiullin"},
      {rank:95, name:"Aleksandar Vukic"},
      {rank:96, name:"Tristan Schoolkate"},
      {rank:97, name:"Dalibor Svrcina"},
      {rank:98, name:"Valentin Royer"},
      {rank:99, name:"Carlos Taberner"},
      {rank:100, name:"Mackenzie McDonald"}
    ];

    // --- State ---
    const STORAGE_KEY_PICKS = 'ft.picks.v1';
    const MAX_PER_BAND = 3;
    const MAX_BUDGET = 900_000_000; // 900M total budget

    let budget = MAX_BUDGET;
    const picks = JSON.parse(localStorage.getItem(STORAGE_KEY_PICKS) || '{"A":[],"B":[],"C":[],"D":[]}');

    // --- Elements ---
    const $grid = document.getElementById('grid');
    const $status = document.getElementById('status');
    const $toast = document.getElementById('toast');
    const $cntA = document.getElementById('cntA');
    const $cntB = document.getElementById('cntB');
    const $cntC = document.getElementById('cntC');
    const $cntD = document.getElementById('cntD');
    const $bandFilter = document.getElementById('bandFilter');
    const $budget = document.getElementById('budget');

    // --- Utils ---
    function bandFor(rank){
      if (rank>=1 && rank<=10) return 'A';
      if (rank>=11 && rank<=30) return 'B';
      if (rank>=31 && rank<=50) return 'C';
      return 'D';
    }
    function costFor(rank){ return (101 - rank) * 1_000_000; }
    function formatM(n){ return (n/1_000_000) + 'M'; }
    function escapeHTML(s){
      return s.replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c]));
    }
    function showToast(msg){
      $toast.textContent = msg;
      $toast.classList.remove('hide');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> $toast.classList.add('hide'), 3000);
    }
    function isSelected(id){
      // check across all bands
      return Object.values(picks).some(arr => arr.includes(id));
    }
    function calcSpent(){
      return Object.values(picks).flat()
        .map(id => parseInt(id.split('|')[0],10))
        .map(costFor)
        .reduce((a,b)=>a+b, 0);
    }
    function updateBudget(){
      const spent = calcSpent();
      budget = MAX_BUDGET - spent;
      $budget.textContent = formatM(budget);
    }
    function updateCounters(){
      $cntA.textContent = `${picks.A.length}/${MAX_PER_BAND}`;
      $cntB.textContent = `${picks.B.length}/${MAX_PER_BAND}`;
      $cntC.textContent = `${picks.C.length}/${MAX_PER_BAND}`;
      $cntD.textContent = `${picks.D.length}/${MAX_PER_BAND}`;
      localStorage.setItem(STORAGE_KEY_PICKS, JSON.stringify(picks));
      updateBudget();
      renderSelected();
      updateStatus();
    }
    function currentFilteredPlayers(){
      const v = $bandFilter.value;
      if (v === 'all') return PLAYERS;
      return PLAYERS.filter(p => bandFor(p.rank) === v);
    }

    // --- Renderers ---
    function renderSelected(){
      const $sel = document.getElementById('selected');
      $sel.innerHTML = '';
      const allSel = Object.values(picks).flat();
      if (allSel.length === 0){
        const empty = document.createElement('div');
        empty.className = 'sub';
        empty.textContent = 'No picks yet. Click players below to add them to your squad.';
        $sel.appendChild(empty);
        return;
      }
      // Sort by rank asc
      const data = allSel.map(id => {
        const [rankStr, name] = id.split('|');
        const rank = parseInt(rankStr,10);
        return {rank, name};
      }).sort((a,b)=>a.rank-b.rank);

      for (const p of data){
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="rank">${p.rank}</div>
          <div style="flex:1;min-width:0">
            <div class="name">${escapeHTML(p.name)}</div>
            <div class="meta">Cost ${formatM(costFor(p.rank))} • Band ${bandFor(p.rank)}</div>
          </div>
        `;
        $sel.appendChild(card);
      }
    }

    function render(players){
      $grid.setAttribute('aria-busy','true');
      $grid.innerHTML = '';
      for (const p of players){
        const band = bandFor(p.rank);
        const id = `${p.rank}|${p.name}`;
        const selected = isSelected(id);

        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'card' + (selected ? ' sel' : '');
        card.setAttribute('data-id', id);
        card.setAttribute('data-band', band);
        card.setAttribute('data-rank', String(p.rank));
        card.setAttribute('aria-pressed', selected ? 'true' : 'false');
        card.title = selected ? 'Click to remove from picks' : 'Click to add to picks';

        card.innerHTML = `
          <div class="rank">${p.rank}</div>
          <div style="flex:1;min-width:0">
            <div class="name">${escapeHTML(p.name)}</div>
            <div class="meta">Cost ${formatM(costFor(p.rank))}</div>
          </div>
          <div class="tag ${band}" aria-hidden="true">${band}</div>
        `;
        $grid.appendChild(card);
      }
      $grid.setAttribute('aria-busy','false');
      updateStatus();
    }

    function updateStatus(){
      const v = $bandFilter.value;
      const map = {all:'All', A:'Band A (1–10)', B:'Band B (11–30)', C:'Band C (31–50)', D:'Band D (51–100)'};
      const showing = currentFilteredPlayers().length;
      $status.textContent = `Showing ${showing} players • Filter: ${map[v]} • Budget left: ${formatM(budget)}. Click a player to add/remove (max ${MAX_PER_BAND} per band).`;
    }

    function renderFiltered(){
      render(currentFilteredPlayers());
    }

    // --- Interactions ---
    $bandFilter.addEventListener('change', () => {
      renderFiltered();
    });

    $grid.addEventListener('click', (e) => {
      const btn = e.target.closest('button.card');
      if (!btn) return;

      const id = btn.getAttribute('data-id');
      const band = btn.getAttribute('data-band');
      const rank = parseInt(btn.getAttribute('data-rank'),10);
      const cost = costFor(rank);

      // Toggle selection
      if (isSelected(id)){
        // remove
        picks[band] = picks[band].filter(x => x !== id);
        showToast('Removed from picks.');
      } else {
        // add with validations
        if (picks[band].length >= MAX_PER_BAND){
          showToast(`Band ${band} is full (max ${MAX_PER_BAND}).`);
          return;
        }
        if (budget - cost < 0){
          showToast('Not enough budget for this player.');
          return;
        }
        picks[band].push(id);
        showToast('Added to picks!');
      }
      updateCounters();
      renderFiltered(); // keep the same view and refresh selection states
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if (!Object.values(picks).some(arr => arr.length)) return;
      picks.A = []; picks.B = []; picks.C = []; picks.D = [];
      updateCounters();
      renderFiltered();
      showToast('All selections cleared.');
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      const spent = calcSpent();
      const left = MAX_BUDGET - spent;

      function lineFor(band){
        const label = {A:'A (1–10)',B:'B (11–30)',C:'C (31–50)',D:'D (51–100)'}[band];
        if (!picks[band].length) return `${label}: —`;
        const parts = picks[band]
          .map(id => {
            const [r, n] = id.split('|');
            return `${r} ${n} (${formatM(costFor(parseInt(r,10)))})`;
          })
          .join(', ');
        return `${label}: ${parts}`;
      }

      const text = [
        'FantaTennis — My Picks (ATP snapshot Aug 25, 2025)',
        lineFor('A'),
        lineFor('B'),
        lineFor('C'),
        lineFor('D'),
        `Total spent: ${formatM(spent)}`,
        `Budget left: ${formatM(left)}`
      ].join('\n');

      try{
        await navigator.clipboard.writeText(text);
        showToast('Picks copied to clipboard.');
      }catch(err){
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); showToast('Picks copied to clipboard.'); }
        catch{ showToast('Copy failed. You can select & copy manually.'); }
        finally{ document.body.removeChild(ta); }
      }
    });

    // --- Initial render ---
    // Ensure budget label starts at the correct value
    $budget.textContent = formatM(budget);
    updateCounters();    // sets counters, budget, selected section, status
    renderFiltered();    // paints the grid according to current filter ("All" by default)
  </script>
</body>
</html>
